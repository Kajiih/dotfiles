{{- if .useGoogleSpecificConfig -}}
#!/bin/bash

# === Apps ===
# https://g3doc.corp.google.com/company/editors/helix/index.md?cl=head
sudo apt install hx

# === Fish Shell ===
# https://g3doc.corp.google.com/company/tools/fish/index.md?cl=head
sudo glinux-add-repo fish-google
sudo apt update
sudo apt install fish fish-google-config

# --- Add Fish startup to .bashrc ---
echo "Setting up fish shell..."
echo "Configuring .bashrc to launch fish shell for interactive sessions..."

BASHRC_FILE=~/.bashrc
FISH_SNIPPET_MARKER="# go/fish-shell#running-fish-from-bash"

# Check if the snippet marker already exists in .bashrc to avoid duplicates.
if ! grep -qF "$FISH_SNIPPET_MARKER" "$BASHRC_FILE"; then
  echo "Adding Fish shell startup snippet to $BASHRC_FILE"
  # Using cat with a HERE document to append the multi-line snippet.
  # Quoting EOF prevents variable expansion within the heredoc.
  cat << 'EOF' >> "$BASHRC_FILE"

# go/fish-shell#running-fish-from-bash
# start fish shell
WHICH_FISH="$(which fish)"
if [[ "$-" =~ i && -x "${WHICH_FISH}" && ! "${SHELL}" -ef "${WHICH_FISH}" ]]; then
  # Safeguard to only activate fish for interactive shells and only if fish
  # shell is present and executable. Verify that this is a new session by
  # checking if $SHELL is set to the path to fish. If it is not, we set
  # $SHELL and start fish.
  #
  # If this is not a new session, the user probably typed 'bash' into their
  # console and wants bash, so we skip this.
  exec env SHELL="${WHICH_FISH}" "${WHICH_FISH}" -i
fi
EOF
  echo "Snippet added. Please start a new shell session or run: source $BASHRC_FILE"
else
  echo "Fish shell startup snippet already exists in $BASHRC_FILE."
fi


# === Ghostty ssh Terminfo ===
# https://ghostty.org/docs/help/terminfo#copy-ghostty's-terminfo-to-a-remote-machine
CLOUDTOP_HOSTNAME=$(hostname)
echo ""
echo "--------------------------------------------------------------------------"
echo "ACTION REQUIRED for Ghostty Terminal Users:"
echo ""
echo "If you use Ghostty on your local machine to SSH to this machine,"
echo "install the 'xterm-ghostty' terminfo to prevent errors."
echo ""
echo "Run this command from YOUR LOCAL MACHINE (e.g., Ombrecoeur):"
echo ""
echo "  infocmp -x xterm-ghostty | ssh ${CLOUDTOP_HOSTNAME} -- 'mkdir -p ~/.terminfo && tic -x -'"
echo ""
echo "This copies Ghostty's terminfo entry to the remote machine."
echo "More info: https://ghostty.site/docs/help/terminfo/"
echo "--------------------------------------------------------------------------"


# === Manual Installation Reminder ===
echo ""
echo "--------------------------------------------------------------------------"
echo "IMPORTANT: Remember to install go/aae-toolbox if you need it."
echo "--------------------------------------------------------------------------"
{{- end }}
